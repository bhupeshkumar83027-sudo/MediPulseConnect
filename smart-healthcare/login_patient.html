<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Patient Login</title>
    <link rel="stylesheet" href="css/style_login_patient.css" />
</head>
<body>
    <!-- Include header -->
    <div id="header-placeholder"></div>

    <div class="container">
        <h1>Patient Login</h1>
        <form action="php/login_patient.php" method="post" id="login_patient_form" class="login-form">
            <input type="email" name="email" placeholder="Email" required />
            <input type="password" name="password" placeholder="Password" required />
            <button type="submit">Login</button>
        </form>
        <p>Don't have an account? <a href="signup_patient.html">Sign Up</a></p>
        <div id="login_message" style="color:red; margin-top:10px;"></div>
    </div>

    <!-- Include footer -->
    <div id="footer-placeholder"></div>

    <script>
      // Load header and footer HTML
      fetch('includes/header.html')
        .then(response => response.text())
        .then(data => {
          document.getElementById('header-placeholder').innerHTML = data;
          feather.replace();
        });
      fetch('includes/footer.html')
        .then(response => response.text())
        .then(data => {
          document.getElementById('footer-placeholder').innerHTML = data;
          feather.replace();
        });

      // AJAX submit
      const form = document.getElementById('login_patient_form');
      const messageDiv = document.getElementById('login_message');

      form.addEventListener('submit', function(e) {
          e.preventDefault();
          const formData = new FormData(form);

          fetch(form.action, {
              method: 'POST',
              body: formData
          })
          .then(res => res.json())
          .then(data => {
              if(data.status === 'success'){
                  messageDiv.style.color = 'green';
                  messageDiv.textContent = data.message;
                  setTimeout(() => {
                      window.location.href = data.redirect;
                  }, 1000);
              } else {
                  messageDiv.style.color = 'red';
                  messageDiv.textContent = data.message;
              }
          })
          .catch(err => {
              messageDiv.style.color = 'red';
              messageDiv.textContent = 'Network error';
              console.error(err);
          });
      });
    </script>

</body>
</html>
