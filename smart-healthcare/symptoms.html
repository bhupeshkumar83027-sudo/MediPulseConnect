<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Symptoms Checker</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style_symptoms.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <header class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title"><i class="fas fa-stethoscope"></i> Smart Symptoms Checker</h1>
      <p class="hero-subtitle">Get instant suggestions based on your symptoms. Not a substitute for professional advice.</p>
    </div>
  </header>

  <main class="main-content">
    <!-- Medicine Suggestion Section -->
    <section class="medicine-section mt-6">
      <div class="medicine-card p-6 rounded-xl shadow-lg bg-white">
        <h2 class="section-title"><i class="fas fa-pills"></i> Medicine Suggestions</h2>
        <p class="medicine-note">Select or type a symptom to get commonly suggested medicines.</p>

        <div class="medicine-inputs mt-4">
          <select id="symptomDropdown" class="medicine-select w-full mb-2"></select>
          <input type="text" id="symptomInputMed" class="medicine-input w-full mb-2" placeholder="Or type symptom...">
          <div class="button-group flex gap-2">
            <button onclick="getSuggestion()" class="suggest-btn bg-yellow-400 px-4 py-2 rounded"><i class="fas fa-lightbulb"></i> Suggest</button>
            <button onclick="clearResult()" class="clear-btn bg-red-400 px-4 py-2 rounded"><i class="fas fa-times"></i> Clear</button>
          </div>
          <button onclick="startRecognitionMedicine()" class="mt-3 bg-blue-500 text-white px-4 py-2 rounded-lg w-full">
            üéôÔ∏è Speak Symptom
          </button>
        </div>
        <div id="resultBox" class="result-box mt-3"></div>
      </div>
    </section>

    <!-- Chatbot Voice Section -->
    <section class="voice-section mt-8">
      <h2 class="section-title"><i class="fas fa-robot"></i> Speak to Chatbot</h2>
      <button onclick="startRecognitionChatbot()" class="bg-green-500 text-white px-4 py-2 rounded-lg">
        üéôÔ∏è Speak Here
      </button>
      <p id="chatbotOutput" class="mt-2 text-gray-700">Say something...</p>
    </section>

    <!-- Contact Doctor Section -->
    <section class="contact-doctor-section mt-8">
      <div class="contact-doctor-card p-6 rounded-xl shadow-lg text-center bg-white">
        <h2 class="section-title"><i class="fas fa-user-md"></i> Contact Doctor</h2>
        <p>Choose an option to contact your doctor:</p>
        <div class="mt-4 flex justify-center gap-4">
          <button id="voiceCallBtn" class="call-btn"><i class="fas fa-phone"></i> Voice Call</button>
          <button id="videoCallBtn" class="call-btn"><i class="fas fa-video"></i> Video Call</button>
        </div>
      </div>
    </section>

    <!-- Back Button -->
    <div class="back-section mt-6">
      <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Dashboard</a>
    </div>
  </main>

  <!-- Doctor Call Redirect -->
  <script>
    document.getElementById('voiceCallBtn').addEventListener('click', () => window.location.href = 'login_patient.html');
    document.getElementById('videoCallBtn').addEventListener('click', () => window.location.href = 'login_patient.html');
  </script>

  <!-- Medicine Voice Recognition -->
  <script>
    function startRecognitionMedicine() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) return alert("Your browser doesn't support Speech Recognition.");

      const recognition = new SpeechRecognition();
      recognition.lang = 'en-US';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;
      recognition.start();

      recognition.onresult = function(event) {
        const speechResult = event.results[0][0].transcript.trim();
        document.getElementById("symptomInputMed").value = speechResult;
        getSuggestion();
      };
    }
  </script>

  <!-- Chatbot Voice Recognition -->
  <script>
    function startRecognitionChatbot() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) return alert("Your browser doesn't support Speech Recognition.");

      const recognition = new SpeechRecognition();
      recognition.lang = 'en-US';
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;
      recognition.start();

      document.getElementById("chatbotOutput").textContent = "üé§ Listening...";

      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript.trim();
        document.getElementById("chatbotOutput").textContent = "You said: " + transcript;

        // Send to Chatbase directly
        if (window.chatbase) {
          window.chatbase("message", transcript, { userId: "patient" });
        }

        // If embedded iframe exists, populate input box
        setTimeout(() => {
          const iframe = document.querySelector("iframe[src*='chatbase']");
          if (iframe) {
            const innerDoc = iframe.contentDocument || iframe.contentWindow.document;
            const inputBox = innerDoc.querySelector("input[type='text'], textarea");
            const sendBtn = innerDoc.querySelector("button, svg");

            if (inputBox) {
              inputBox.value = transcript;
              inputBox.dispatchEvent(new Event("input", { bubbles: true }));
              if (sendBtn) sendBtn.click();
            }
          }
        }, 1000);
      };

      recognition.onerror = function(e) { console.log("Speech recognition error:", e); };
      recognition.onend = function() { console.log("Speech recognition ended."); };
    }
  </script>

  <!-- Chatbase Embed -->
  <script>
    (function(){
      if(!window.chatbase || window.chatbase("getState") !== "initialized") {
        window.chatbase = (...args) => {
          if(!window.chatbase.q) window.chatbase.q = [];
          window.chatbase.q.push(args);
        };
        window.chatbase = new Proxy(window.chatbase, {
          get(target, prop) {
            if(prop === "q") return target.q;
            return (...args) => target(prop, ...args);
          }
        });
      }
      const onLoad = function() {
        const script = document.createElement("script");
        script.src = "https://www.chatbase.co/embed.min.js";
        script.id = "5pf832nZZJFnf_fPGX1bI"; // chatbot ID
        script.domain = "www.chatbase.co";
        document.body.appendChild(script);
      };
      if(document.readyState === "complete") onLoad();
      else window.addEventListener("load", onLoad);
    })();
  </script>

  <!-- Medicine Suggestion Script -->
  <script src="js/script_symptoms.js"></script>
  <script>
(function(){
  const script = document.createElement("script");
  script.src = "https://www.chatbase.co/embed.min.js";
  script.id = "5pf832nZZJFnf_fPGX1b"; // replace with your Chatbase chatbot ID
  script.async = true;
  document.body.appendChild(script);
})();
</script>

</body>
</html>
